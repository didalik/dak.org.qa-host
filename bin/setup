#!/bin/bash

_add_account () { # {{{1
  local user=$1 userdesc=$2
  echo "- _add_account started on $(date) $user $userdesc"
  sudo useradd -md /home/$user -c "$userdesc" -s /bin/bash -k $user -U $user
  sudo -u $user chmod 600 /home/$user/.ssh/authorized_keys
}

_copy_ssh_configs () { # TODO make it better {{{1
  [ -e /etc/ssh/ssh_config.pre-hub4qa ] && return
  echo "- _copy_ssh_configs started on $(date)"
  sudo cp /etc/ssh/ssh_config /etc/ssh/ssh_config.pre-hub4qa
  sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.pre-hub4qa
  sudo cp etc/ssh/ssh*config /etc/ssh/
}

setup_qa_hub () { # {{{1
  _copy_ssh_configs
  _add_account $1 "$2"
  _add_account $3 "$4"

  ls -la /home/$USER/.ssh
  sudo -u $1 ls -la /home/$1/.ssh
  sudo -u $3 ls -la /home/$3/.ssh
}

echo "- $0 started on $(date) $#: $@"
setup_qa_hub $1 "$2" $3 "$4"
